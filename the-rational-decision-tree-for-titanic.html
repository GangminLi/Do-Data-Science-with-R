<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1.4 The Rational Decision Tree for Titanic | 07-decision-tree.utf8</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="1.4 The Rational Decision Tree for Titanic | 07-decision-tree.utf8" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1.4 The Rational Decision Tree for Titanic | 07-decision-tree.utf8" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-full-house-decision-tree-for-titanic.html"/>
<link rel="next" href="summary.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Authoring Books with R Markdown</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="prediction-with-decision-trees.html"><a href="prediction-with-decision-trees.html"><i class="fa fa-check"></i><b>1</b> Prediction with Decision Trees</a><ul>
<li class="chapter" data-level="1.1" data-path="decision-tree-in-hunts-algorithm.html"><a href="decision-tree-in-hunts-algorithm.html"><i class="fa fa-check"></i><b>1.1</b> Decision tree in Hunt’s Algorithm</a><ul>
<li class="chapter" data-level="1.1.1" data-path="decision-tree-in-hunts-algorithm.html"><a href="decision-tree-in-hunts-algorithm.html#test_condition"><i class="fa fa-check"></i><b>1.1.1</b> How to Form a Test Condition?</a></li>
<li class="chapter" data-level="1.1.2" data-path="decision-tree-in-hunts-algorithm.html"><a href="decision-tree-in-hunts-algorithm.html#best_split"><i class="fa fa-check"></i><b>1.1.2</b> How to Determine the Best Split Condition?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="the-simplest-decision-tree-for-titanic.html"><a href="the-simplest-decision-tree-for-titanic.html"><i class="fa fa-check"></i><b>1.2</b> The Simplest Decision Tree for Titanic</a></li>
<li class="chapter" data-level="1.3" data-path="the-full-house-decision-tree-for-titanic.html"><a href="the-full-house-decision-tree-for-titanic.html"><i class="fa fa-check"></i><b>1.3</b> The Full-house Decision Tree for Titanic</a></li>
<li class="chapter" data-level="1.4" data-path="the-rational-decision-tree-for-titanic.html"><a href="the-rational-decision-tree-for-titanic.html"><i class="fa fa-check"></i><b>1.4</b> The Rational Decision Tree for Titanic</a></li>
<li class="chapter" data-level="1.5" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>1.5</b> Summary</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-rational-decision-tree-for-titanic" class="section level2">
<h2><span class="header-section-number">1.4</span> The Rational Decision Tree for Titanic</h2>
<p>Now let us use our re-engineered train dataset to train our classifier to see how could we improve our prediction results.</p>
<p>We firstly use all the attributes: <em>Pclass</em>, <em>Title</em>, <em>Sex</em>, <em>Age_group</em>,,<em>Group_size</em>, <em>Ticket_class</em>, <em>Fare_pp</em>, <em>Deck</em>, <em>HasCabinNum</em> and <em>Embarked</em>. We somehow escape <em>Name</em> and <em>Ticket</em>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="the-rational-decision-tree-for-titanic.html#cb18-1"></a><span class="co"># The full-house classifier apart from name and ticket</span></span>
<span id="cb18-2"><a href="the-rational-decision-tree-for-titanic.html#cb18-2"></a>RE_data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;RE_data.csv&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</span>
<span id="cb18-3"><a href="the-rational-decision-tree-for-titanic.html#cb18-3"></a>model3 &lt;-<span class="st"> </span><span class="kw">rpart</span>(Survived <span class="op">~</span><span class="st"> </span>Pclass<span class="op">+</span>Title<span class="op">+</span>Sex <span class="op">+</span>Age_group<span class="op">+</span>Group_size<span class="op">+</span>Ticket_class<span class="op">+</span>Fare_pp<span class="op">+</span>Deck<span class="op">+</span>HasCabinNum <span class="op">+</span><span class="st"> </span>Embarked,</span>
<span id="cb18-4"><a href="the-rational-decision-tree-for-titanic.html#cb18-4"></a>              <span class="dt">data=</span>RE_data[<span class="dv">1</span><span class="op">:</span><span class="dv">891</span>,],</span>
<span id="cb18-5"><a href="the-rational-decision-tree-for-titanic.html#cb18-5"></a>              <span class="dt">method=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb18-6"><a href="the-rational-decision-tree-for-titanic.html#cb18-6"></a>Prediction3 &lt;-<span class="st"> </span><span class="kw">predict</span>(model3, RE_data[<span class="dv">892</span><span class="op">:</span><span class="dv">1309</span>,], <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb18-7"><a href="the-rational-decision-tree-for-titanic.html#cb18-7"></a>submit3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">PassengerId =</span> RE_data[<span class="dv">892</span><span class="op">:</span><span class="dv">1309</span>,<span class="dv">1</span>], <span class="dt">Survived =</span> Prediction3)</span>
<span id="cb18-8"><a href="the-rational-decision-tree-for-titanic.html#cb18-8"></a><span class="kw">write.csv</span>(submit3, <span class="dt">file =</span> <span class="st">&quot;myReEngineeredResult.CSV&quot;</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>We have produced a new prediction with new model. You can submit to Kaggle for an evaluation. You may find it has a pretty bed score (0.75598)! It even worse than the decision tree with only lookin gin to sex!!! Let us examine our classifier again by plot it in a graph.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="the-rational-decision-tree-for-titanic.html#cb19-1"></a><span class="co"># plot our full house classifier </span></span>
<span id="cb19-2"><a href="the-rational-decision-tree-for-titanic.html#cb19-2"></a><span class="kw">prp</span>(model3, <span class="dt">type =</span> <span class="dv">0</span>, <span class="dt">extra =</span> <span class="dv">1</span>, <span class="dt">under =</span> <span class="ot">TRUE</span>)</span>
<span id="cb19-3"><a href="the-rational-decision-tree-for-titanic.html#cb19-3"></a><span class="kw">fancyRpartPlot</span>(model3)</span></code></pre></div>
<div class="figure"><span id="fig:multi-plots"></span>
<img src="07-decision-tree_files/figure-html/multi-plots-1.svg" alt="Decision trees." width="50%" /><img src="07-decision-tree_files/figure-html/multi-plots-2.svg" alt="Decision trees." width="50%" />
<p class="caption">
Figure 1.5: Decision trees.
</p>
</div>
<p>We can see from the tree, the first test condition is <code>"title = Mr"</code>. We know that there are large number of passengers are male adult and most of them are perished. However, we can see from our decision tree (left branch) that there are two further test conditions are “Ticket_class” and “Deck” numbers. Our tree end with 2 leafs are survived and one is dead. The purity on the leads are not very high, the highest is 39:366 and the lowest is 1:2. However we know that the most powerful predictor Sex and pclass has not been used. That could be an explanation of the poor performance. We will demonstrate the detailed interpretation of the model in the later chapter of report.</p>
<p>Let us look into the difference between the last two predictions,</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="the-rational-decision-tree-for-titanic.html#cb20-1"></a><span class="co"># build a comparison data frame to record each prediction results</span></span>
<span id="cb20-2"><a href="the-rational-decision-tree-for-titanic.html#cb20-2"></a>compare &lt;-<span class="st"> </span><span class="kw">data.frame</span>(test<span class="op">$</span>PassengerId, <span class="dt">predict2 =</span> Prediction2 , <span class="dt">predict3 =</span> Prediction3)</span>
<span id="cb20-3"><a href="the-rational-decision-tree-for-titanic.html#cb20-3"></a><span class="co"># Find differences</span></span>
<span id="cb20-4"><a href="the-rational-decision-tree-for-titanic.html#cb20-4"></a>dif2 &lt;-<span class="st"> </span>compare[compare[<span class="dv">2</span>] <span class="op">!=</span><span class="st"> </span>compare[<span class="dv">3</span>], ]</span>
<span id="cb20-5"><a href="the-rational-decision-tree-for-titanic.html#cb20-5"></a><span class="co">#show dif</span></span>
<span id="cb20-6"><a href="the-rational-decision-tree-for-titanic.html#cb20-6"></a>dif2</span></code></pre></div>
<pre><code>##     test.PassengerId predict2 predict3
## 19               910        0        1
## 20               911        1        0
## 22               913        0        1
## 34               925        0        1
## 42               933        0        1
## 50               941        1        0
## 65               956        0        1
## 73               964        0        1
## 74               965        0        1
## 99               990        0        1
## 126             1017        1        0
## 147             1038        0        1
## 154             1045        1        0
## 158             1049        0        1
## 159             1050        0        1
## 162             1053        0        1
## 166             1057        0        1
## 182             1073        0        1
## 193             1084        0        1
## 195             1086        0        1
## 198             1089        0        1
## 207             1098        1        0
## 237             1128        0        1
## 243             1134        0        1
## 245             1136        0        1
## 246             1137        0        1
## 285             1176        0        1
## 310             1201        1        0
## 314             1205        1        0
## 340             1231        0        1
## 345             1236        0        1
## 346             1237        0        1
## 348             1239        1        0
## 355             1246        0        1
## 356             1247        0        1
## 384             1275        1        0
## 393             1284        0        1
## 405             1296        0        1
## 413             1304        0        1
## 418             1309        0        1</code></pre>
<p>There are 40 different predictions in comparison with the second prediction model.
Let us see if we can improve on this.</p>
<p>Let us consider the correlation analysis and PCA analyses results. We only use three most related attributes: <em>Sex</em>, <em>Pclass</em>, <em>Fare_pp</em>, and <em>Age_group</em>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="the-rational-decision-tree-for-titanic.html#cb22-1"></a>model4 &lt;-<span class="st"> </span><span class="kw">rpart</span>(Survived <span class="op">~</span><span class="st"> </span>Sex <span class="op">+</span><span class="st">  </span>Fare_pp <span class="op">+</span><span class="st"> </span>Pclass <span class="op">+</span><span class="st"> </span>Age_group,</span>
<span id="cb22-2"><a href="the-rational-decision-tree-for-titanic.html#cb22-2"></a>              <span class="dt">data=</span>RE_data[<span class="dv">1</span><span class="op">:</span><span class="dv">891</span>,],</span>
<span id="cb22-3"><a href="the-rational-decision-tree-for-titanic.html#cb22-3"></a>              <span class="dt">method=</span><span class="st">&quot;class&quot;</span>)</span>
<span id="cb22-4"><a href="the-rational-decision-tree-for-titanic.html#cb22-4"></a>Prediction4 &lt;-<span class="st"> </span><span class="kw">predict</span>(model4, RE_data[<span class="dv">892</span><span class="op">:</span><span class="dv">1309</span>,], <span class="dt">type =</span> <span class="st">&quot;class&quot;</span>)</span>
<span id="cb22-5"><a href="the-rational-decision-tree-for-titanic.html#cb22-5"></a>submit4&lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">PassengerId =</span> RE_data[<span class="dv">892</span><span class="op">:</span><span class="dv">1309</span>,<span class="dv">1</span>], <span class="dt">Survived =</span> Prediction4)</span>
<span id="cb22-6"><a href="the-rational-decision-tree-for-titanic.html#cb22-6"></a><span class="kw">write.csv</span>(submit4, <span class="dt">file =</span> <span class="st">&quot;myShortReEngineeredResult.CSV&quot;</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>We do the same to understand what went wrong.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="the-rational-decision-tree-for-titanic.html#cb23-1"></a><span class="co"># plot our full house classifier </span></span>
<span id="cb23-2"><a href="the-rational-decision-tree-for-titanic.html#cb23-2"></a><span class="kw">fancyRpartPlot</span>(model4)</span></code></pre></div>
<p><img src="07-decision-tree_files/figure-html/unnamed-chunk-13-1.svg" width="672" /></p>
<p>After submit to Kaggle and the feedback was no improvement and even get a worse score (0.75358). Let us look into the difference between the last two predictions,</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="the-rational-decision-tree-for-titanic.html#cb24-1"></a><span class="co"># build a comparison data frame to record each prediction results</span></span>
<span id="cb24-2"><a href="the-rational-decision-tree-for-titanic.html#cb24-2"></a>compare &lt;-<span class="st"> </span><span class="kw">data.frame</span>(test<span class="op">$</span>PassengerId, <span class="dt">predict3 =</span> Prediction3 , <span class="dt">predict4 =</span> Prediction4)</span>
<span id="cb24-3"><a href="the-rational-decision-tree-for-titanic.html#cb24-3"></a><span class="co"># Find differences</span></span>
<span id="cb24-4"><a href="the-rational-decision-tree-for-titanic.html#cb24-4"></a>dif &lt;-<span class="st"> </span>compare[compare[<span class="dv">2</span>] <span class="op">!=</span><span class="st"> </span>compare[<span class="dv">3</span>], ]</span>
<span id="cb24-5"><a href="the-rational-decision-tree-for-titanic.html#cb24-5"></a><span class="co">#show dif</span></span>
<span id="cb24-6"><a href="the-rational-decision-tree-for-titanic.html#cb24-6"></a>dif</span></code></pre></div>
<pre><code>##      test.PassengerId predict3 predict4
## 896               896        1        0
## 913               913        1        0
## 915               915        0        1
## 925               925        1        0
## 926               926        0        1
## 933               933        1        0
## 942               942        0        1
## 956               956        1        0
## 960               960        0        1
## 972               972        1        0
## 982               982        1        0
## 986               986        0        1
## 996               996        1        0
## 1009             1009        1        0
## 1038             1038        1        0
## 1050             1050        1        0
## 1051             1051        1        0
## 1053             1053        1        0
## 1084             1084        1        0
## 1093             1093        1        0
## 1098             1098        0        1
## 1106             1106        0        1
## 1117             1117        1        0
## 1128             1128        1        0
## 1134             1134        1        0
## 1136             1136        1        0
## 1137             1137        1        0
## 1141             1141        1        0
## 1155             1155        1        0
## 1173             1173        1        0
## 1175             1175        1        0
## 1176             1176        1        0
## 1183             1183        1        0
## 1198             1198        0        1
## 1199             1199        1        0
## 1205             1205        0        1
## 1215             1215        0        1
## 1223             1223        0        1
## 1225             1225        1        0
## 1227             1227        0        1
## 1231             1231        1        0
## 1236             1236        1        0
## 1239             1239        0        1
## 1246             1246        1        0
## 1247             1247        1        0
## 1284             1284        1        0
## 1296             1296        1        0
## 1301             1301        1        0
## 1309             1309        1        0</code></pre>
<p>The point I guess is the decision tree will not improved with more attributes and also our re-engineered dataset does not improve on the prediction.</p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-full-house-decision-tree-for-titanic.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="summary.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown/edit/master/inst/examples/%s",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "none"
},
"search": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
